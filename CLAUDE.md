# Claude-Kit — Shared Configuration

This file is imported by every beekeeper-lab project via `@.claude/shared/CLAUDE.md`.

## Architecture

```
project/.claude/
  shared/           ← git submodule (this repo)
  local/            ← project-specific (committed to project repo)
  commands/         ← GENERATED symlinks from shared + local (gitignored)
  skills/           ← GENERATED symlinks (gitignored)
  agents/           ← GENERATED symlinks (gitignored)
  hooks/            ← GENERATED symlinks (gitignored)
  settings.json     ← GENERATED by merging shared + local (gitignored)
```

**Layer priority:** local overrides shared on name collision.

## Syncing

After clone, pull, or submodule update:

```bash
scripts/claude-sync.sh
```

This rebuilds symlinks, merges settings, and installs git hooks. It runs automatically via post-merge and post-checkout git hooks.

## Branching Model

- **Never edit files directly on `main`.** The branch protection hook blocks writes on main/master.
- Create a feature branch: `git checkout -b feat/my-change`
- Push and create a PR for review.

## Safety Hooks

Two safety hooks run on every tool use:

- **bash_safety.py** — Blocks dangerous shell commands (force push, rm -rf /, pipe curl to bash, push to main)
- **write_safety.py** — Blocks writes to sensitive files (.env, SSH keys, /etc, credentials)

These are enforced via `settings.json` PreToolUse hooks and cannot be bypassed.

## Available Agents

| Agent | File | Role |
|-------|------|------|
| Team Lead | `agents/team-lead.md` | Orchestrates work, decomposes beans, assigns tasks |
| Architect | `agents/architect.md` | System design, ADRs, module boundaries |
| Developer | `agents/developer.md` | Implementation, refactoring, code changes |
| Tech QA | `agents/tech-qa.md` | Test plans, test implementation, quality gates |
| BA | `agents/ba.md` | Requirements, user stories, acceptance criteria |

## Available Commands

### Workflow Commands
- `/bug <description>` — Create a TDD bug fix plan
- `/feature <description>` — Create a TDD feature plan
- `/chore <description>` — Create a TDD chore plan
- `/implement <plan>` — Execute an implementation plan
- `/test-gen <target>` — Generate tests (UI-first approach)
- `/tools` — List built-in tools

### Operational Commands
- `/commands` — List all available commands
- `/deploy` — Create releases with validation
- `/git-status` — Check branch sync status
- `/bg <command>` — Run a command in background tmux
- `/run <script>` — Execute a script
- `/long-run` — Autonomous backlog processing

### Backlog Commands
- `/show-backlog` — Display the bean backlog
- `/backlog-refinement` — Refine raw ideas into beans
- `/backlog-consolidate` — Consolidate beans
- `/review-beans` — Review bean status
- `/status-report` — Generate progress summary

## Cross-Cutting Rules

1. **No secrets in code.** Never hardcode secrets, API keys, or credentials.
2. **Validate at boundaries.** Validate all external inputs at system boundaries.
3. **Small and incremental.** Deliver in thin vertical slices. Small PRs, small stories.
4. **Decisions are recorded.** Every significant decision gets documented rationale.
5. **Run tests before marking done.** Always run the project's test suite.
6. **No disabled safety checks.** Do not disable linters, hooks, or safety checks.

## Kit Management

- **Shared assets** live in this repo (agents, commands, hooks, skills, settings.json)
- **Local assets** live in each project's `.claude/local/` directory
- **Generated layer** is rebuilt by `scripts/claude-sync.sh` — never edit files in `.claude/commands/`, `.claude/skills/`, etc. directly
- Only the **foundry** project pushes changes to this repo
