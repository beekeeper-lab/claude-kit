# Task 01: Requirements & Scope for Overlay Mode

| Field | Value |
|-------|-------|
| **Owner** | ba |
| **Depends On** | — |
| **Status** | Done |

## Goal

Produce clear requirements and acceptance criteria for the overlay feature so that Architect and Developer know exactly what to build. Clarify edge cases around conflicts, existing files, and user expectations.

## Inputs

- `ai/beans/BEAN-002-generator-overlay/bean.md` — problem statement, goal, scope
- `foundry_app/services/generator.py` — current pipeline (no overlay support)
- `foundry_app/services/scaffold.py` — current scaffold logic (creates fresh dirs)
- `foundry_app/cli.py` — current CLI args (no --overlay or --dry-run)
- `ai/context/project.md` — architecture overview

## Deliverables

Write to `ai/outputs/ba/bean-002-overlay-requirements.md`:

1. **User stories** with acceptance criteria (Given/When/Then):
   - As a developer, I want to run `foundry-cli generate --overlay .` so that Foundry updates my existing project's `.claude/` and `ai/` directories without disturbing my source code.
   - As a developer, I want a `--dry-run` flag so I can preview what overlay would change before committing.
   - As a developer, I want clear conflict reports when generated files differ from existing ones.

2. **Scope boundary** — what overlay touches and what it leaves alone:
   - Overlay writes to: `.claude/`, `ai/`, `CLAUDE.md` (if generated), `README.md` (if generated)
   - Overlay never touches: source code, tests, config files not generated by Foundry
   - Conflict = file exists AND content differs from what would be generated

3. **Edge cases:**
   - Target dir doesn't exist (error? create?)
   - File exists with identical content (skip silently? report as unchanged?)
   - `ai/context/project.md` has been hand-edited (conflict or skip?)
   - Manifest exists from previous generation (use for diffing?)
   - `settings.local.json` has been manually modified

4. **Risk register** — what could go wrong

## Acceptance Criteria

- [ ] At least 3 user stories with Given/When/Then acceptance criteria
- [ ] Scope boundary document clearly separates overlay-managed vs. user-managed files
- [ ] Edge cases listed with recommended behavior for each
- [ ] Risk register with at least 3 identified risks
- [ ] Requirements are testable by Tech-QA

## Definition of Done

- [ ] `ai/outputs/ba/bean-002-overlay-requirements.md` exists with all deliverables
- [ ] Requirements reviewed: no ambiguous terms, all edge cases addressed
- [ ] Downstream personas (Architect, Developer) can implement without guessing
